<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Juego Móvil con Controles Predefinidos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            color: #fff;
            touch-action: none;
        }
        
        #pantalla-completa-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            text-align: center;
            padding: 2vw;
            position: relative;
        }
        
        .titulo {
            font-size: clamp(24px, 5vw, 32px);
            margin-bottom: 1.5vh;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: #e94560;
        }
        
        .subtitulo {
            font-size: clamp(16px, 3vw, 20px);
            margin-bottom: 3vh;
            max-width: 80%;
            color: #b8b8d1;
        }
        
        #btn-pantalla-completa {
            padding: clamp(12px, 2vw, 16px) clamp(24px, 4vw, 32px);
            font-size: clamp(16px, 3vw, 20px);
            background-color: #e94560;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 2vh;
            font-weight: bold;
        }
        
        #btn-pantalla-completa:hover {
            background-color: #ff577f;
            transform: scale(1.05);
        }
        
        #btn-pantalla-completa:active {
            transform: scale(0.98);
        }
        
        .info-sonido {
            background-color: rgba(0, 0, 0, 0.3);
            padding: clamp(10px, 2vw, 15px);
            border-radius: 10px;
            max-width: 90%;
            margin-top: 2vh;
            font-size: clamp(12px, 2.5vw, 14px);
            border-left: 4px solid #0f3460;
        }
        
        #juego-container {
            display: none;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        #lienzo-juego {
            background: linear-gradient(to bottom, #2c3e50, #4a69bd);
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
        }
        
        .control-btn {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(145deg, #e94560, #c53d54);
            border: none;
            color: white;
            font-size: clamp(16px, 3vw, 20px);
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            touch-action: none;
            z-index: 10;
            transition: transform 0.1s ease;
        }
        
        .control-btn:active {
            transform: scale(0.95);
            background: linear-gradient(145deg, #ff577f, #e94560);
        }
        
        #estado-juego {
            position: absolute;
            top: 2vh;
            left: 2vw;
            background-color: rgba(0, 0, 0, 0.7);
            padding: clamp(8px, 1.5vw, 10px) clamp(12px, 2vw, 15px);
            border-radius: 20px;
            font-size: clamp(12px, 2.5vw, 14px);
            z-index: 100;
        }
        
        #cargando {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #e94560;
            width: clamp(30px, 5vw, 40px);
            height: clamp(30px, 5vw, 40px);
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5vh;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Media queries para pantallas grandes (PCs) */
        @media (min-width: 768px) {
            .titulo {
                font-size: clamp(28px, 4vw, 36px);
            }
            .subtitulo {
                font-size: clamp(18px, 2.5vw, 22px);
                max-width: 50%;
            }
            #btn-pantalla-completa {
                padding: clamp(14px, 2vw, 18px) clamp(28px, 4vw, 36px);
                font-size: clamp(18px, 3vw, 22px);
            }
            .info-sonido {
                max-width: 40%;
            }
            .control-btn {
                font-size: clamp(18px, 2.5vw, 22px);
            }
            #estado-juego {
                font-size: clamp(14px, 2vw, 16px);
            }
        }
    </style>
</head>
<body>
    <div id="pantalla-completa-container">
        <h1 class="titulo">Juego Móvil</h1>
        <p class="subtitulo">Activa el modo pantalla completa para comenzar a jugar</p>
        <button id="btn-pantalla-completa">Pantalla Completa</button>
        
        <div class="info-sonido">
            <strong>Controles predefinidos:</strong> El juego utiliza una configuración de controles preestablecida.
        </div>
    </div>
    
    <div id="juego-container">
        <canvas id="lienzo-juego"></canvas>
        
        <div id="estado-juego">Controles cargados: 0/9</div>
        
        <div id="cargando">
            <div class="spinner"></div>
            <p>Cargando controles...</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const btnPantallaCompleta = document.getElementById('btn-pantalla-completa');
            const pantallaCompletaContainer = document.getElementById('pantalla-completa-container');
            const juegoContainer = document.getElementById('juego-container');
            const lienzoJuego = document.getElementById('lienzo-juego');
            const estadoJuego = document.getElementById('estado-juego');
            const cargando = document.getElementById('cargando');
            
            // Variables para el juego
            let audioContext = null;
            let controlesConfig = null;
            let botones = {};
            
            // Dimensiones de referencia (basadas en el JSON original)
            const referenciaAncho = 667;
            const referenciaAlto = 375;
            
            // Solicitar pantalla completa
            btnPantallaCompleta.addEventListener('click', function() {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                activarAudio();
            });
            
            // Evento para cuando se activa el modo pantalla completa
            document.addEventListener('fullscreenchange', manejarCambioPantallaCompleta);
            document.addEventListener('webkitfullscreenchange', manejarCambioPantallaCompleta);
            document.addEventListener('mozfullscreenchange', manejarCambioPantallaCompleta);
            document.addEventListener('MSFullscreenChange', manejarCambioPantallaCompleta);
            
            function manejarCambioPantallaCompleta() {
                const esPantallaCompleta = document.fullscreenElement || 
                                          document.webkitFullscreenElement || 
                                          document.mozFullScreenElement ||
                                          document.msFullscreenElement;
                
                if (esPantallaCompleta) {
                    pantallaCompletaContainer.style.display = 'none';
                    juegoContainer.style.display = 'block';
                    ajustarTamanioCanvas();
                    cargarConfiguracionControles();
                } else {
                    pantallaCompletaContainer.style.display = 'flex';
                    juegoContainer.style.display = 'none';
                }
            }
            
            function ajustarTamanioCanvas() {
                lienzoJuego.width = window.innerWidth;
                lienzoJuego.height = window.innerHeight;
                actualizarPosicionesBotones(); // Actualizar posiciones de los botones
                dibujarJuego(); // Redibujar el juego
            }
            
            // Ajustar el tamaño del canvas y botones si la ventana cambia de tamaño
            window.addEventListener('resize', ajustarTamanioCanvas);
            
            // Función para activar el sistema de audio
            function activarAudio() {
                if (audioContext) return;
                
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log("Sistema de audio activado correctamente");
                } catch (e) {
                    console.error("Error al activar el audio: ", e);
                }
            }
            
            // Función para crear un sonido
            function playSonido(frecuencia, duracion) {
                if (!audioContext) return;
                
                const oscilador = audioContext.createOscillator();
                const ganancia = audioContext.createGain();
                
                oscilador.type = 'sine';
                oscilador.frequency.setValueAtTime(frecuencia, audioContext.currentTime);
                ganancia.gain.setValueAtTime(0.3, audioContext.currentTime);
                oscilador.connect(ganancia);
                ganancia.connect(audioContext.destination);
                oscilador.start();
                oscilador.stop(audioContext.currentTime + duracion);
            }
            
            // Cargar configuración de controles desde el JSON
            async function cargarConfiguracionControles() {
                try {
                    cargando.style.display = 'block';
                    
                    const respuesta = await fetch('https://raw.githubusercontent.com/papelerio/J/refs/heads/main/Controles.json');
                    if (!respuesta.ok) {
                        throw new Error('Error al cargar la configuración de controles');
                    }
                    
                    const datos = await respuesta.json();
                    controlesConfig = datos.controles;
                    
                    crearBotonesControles();
                    cargando.style.display = 'none';
                } catch (error) {
                    console.error('Error:', error);
                    cargando.innerHTML = '<p>Error al cargar la configuración de controles</p>';
                }
            }
            
            // Crear botones de control basados en la configuración
            function crearBotonesControles() {
                if (!controlesConfig) return;
                
                let controlesCargados = 0;
                const letras = Object.keys(controlesConfig);
                
                letras.forEach(letra => {
                    const config = controlesConfig[letra];
                    
                    const boton = document.createElement('button');
                    boton.className = 'control-btn';
                    boton.id = `btn-${letra}`;
                    boton.textContent = letra;
                    
                    // Escalar posición y tamaño
                    const escalaX = window.innerWidth / referenciaAncho;
                    const escalaY = window.innerHeight / referenciaAlto;
                    boton.style.width = `${config.width * escalaX}px`;
                    boton.style.height = `${config.height * escalaY}px`;
                    boton.style.left = `${config.x * escalaX}px`;
                    boton.style.top = `${config.y * escalaY}px`;
                    
                    // Añadir eventos
                    boton.addEventListener('click', () => {
                        const frecuencia = 200 + (letra.charCodeAt(0) - 65) * 50;
                        playSonido(frecuencia, 0.2);
                        console.log(`Botón ${letra} presionado`);
                    });
                    
                    boton.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        const frecuencia = 200 + (letra.charCodeAt(0) - 65) * 50;
                        playSonido(frecuencia, 0.2);
                        console.log(`Botón ${letra} presionado (touch)`);
                    }, { passive: false });
                    
                    juegoContainer.appendChild(boton);
                    botones[letra] = boton;
                    
                    controlesCargados++;
                    estadoJuego.textContent = `Controles cargados: ${controlesCargados}/${letras.length}`;
                });
            }
            
            // Actualizar posiciones de los botones al cambiar el tamaño de la ventana
            function actualizarPosicionesBotones() {
                if (!controlesConfig || !botones) return;
                
                const escalaX = window.innerWidth / referenciaAncho;
                const escalaY = window.innerHeight / referenciaAlto;
                
                Object.keys(controlesConfig).forEach(letra => {
                    const config = controlesConfig[letra];
                    const boton = botones[letra];
                    if (boton) {
                        boton.style.width = `${config.width * escalaX}px`;
                        boton.style.height = `${config.height * escalaY}px`;
                        boton.style.left = `${config.x * escalaX}px`;
                        boton.style.top = `${config.y * escalaY}px`;
                    }
                });
            }
            
            // Dibujar el juego en el canvas
            function dibujarJuego() {
                const contexto = lienzoJuego.getContext('2d');
                
                contexto.fillStyle = '#2c3e50';
                contexto.fillRect(0, 0, lienzoJuego.width, lienzoJuego.height);
                
                contexto.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                contexto.lineWidth = 1;
                
                const gridSize = Math.min(window.innerWidth, window.innerHeight) / 10;
                for (let x = 0; x < lienzoJuego.width; x += gridSize) {
                    contexto.beginPath();
                    contexto.moveTo(x, 0);
                    contexto.lineTo(x, lienzoJuego.height);
                    contexto.stroke();
                }
                
                for (let y = 0; y < lienzoJuego.height; y += gridSize) {
                    contexto.beginPath();
                    contexto.moveTo(0, y);
                    contexto.lineTo(lienzoJuego.width, y);
                    contexto.stroke();
                }
                
                contexto.fillStyle = 'white';
                contexto.font = `${clamp(16, 3, 20)}px Arial`;
                contexto.textAlign = 'center';
                contexto.fillText('¡Juego con controles predefinidos!', lienzoJuego.width/2, 50);
                contexto.font = `${clamp(12, 2.5, 16)}px Arial`;
                contexto.fillText('Presiona los botones para interactuar', lienzoJuego.width/2, 80);
            }
            
            // Función auxiliar para clamp
            function clamp(min, vw, max) {
                return Math.min(Math.max(window.innerWidth * vw / 100, min), max);
            }
        });
    </script>
</body>
</html>
